var e=Object.defineProperty,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(r,t,s)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,o=(e,r,t)=>new Promise(((s,a)=>{var o=e=>{try{n(t.next(e))}catch(r){a(r)}},d=e=>{try{n(t.throw(e))}catch(r){a(r)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,d);n((t=t.apply(e,r)).next())}));import{u as d,B as n}from"./useForm.0379175d.js";import"./BasicForm.vue_vue_type_style_index_0_lang.daafa440.js";import{G as i,aS as l}from"./index.8e60a3c0.js";import{b as c}from"./user.data.7a0af023.js";import{u as p,B as u}from"./index.a4c2ac5a.js";import{d as f,e as m,f as v,g as y,s as h}from"./validator.f9ca1444.js";import{k as w,d as b,M as I,u as g,e as j,a2 as P,ab as x,ad as O,f as _,ac as F}from"./vue-vendor.1938e417.js";import{u as S,y as k}from"./vendor.ece5be17.js";const A={"<=565":"100%","<=1366":"800px","<=1600":"600px","<=1920":"600px",">1920":"500px"};function T(){return function(e=A,r=!0,t=50){const s=r?Object.assign({},A,e):e,a=Object.keys(s),o=w();function d(e){let r;for(const o of a)try{if(new Function(`return ${e} ${o}`)()){r=s[o];break}}catch(t){}r&&(o.value=r)}d(window.innerWidth);const{removeEvent:n}=i({el:window,name:"resize",listener:S((()=>d(window.innerWidth)),t)});return k((()=>n())),{adaptiveWidth:o}}({"<=620":"100%","<=1600":600,"<=1920":650,">1920":700},!1)}const D=b({__name:"UserDrawer",emits:["success","register"],setup(e,{emit:i}){I();const b=w(!0),S=w(""),k=w([]),[A,{setProps:D,resetFields:R,setFieldsValue:W,validate:B,updateSchema:L}]=d({labelWidth:90,schemas:c,showActionButtonGroup:!1}),U=w(!0),[$,{setDrawerProps:E,closeDrawer:G}]=p((e=>o(this,null,(function*(){var o;if(yield R(),U.value=null==(o=null==e?void 0:e.showFooter)||o,E({confirmLoading:!1,showFooter:U.value}),b.value=!!(null==e?void 0:e.isUpdate),g(b)){S.value=e.record.id,e.record.relTenantIds&&!Array.isArray(e.record.relTenantIds)&&(e.record.relTenantIds=e.record.relTenantIds.split(","));try{const r=yield f({userid:e.record.id});r&&r.length>0&&(e.record.selectedroles=r)}catch(d){}const r=yield m({userId:e.record.id});if(r&&r.length>0){e.record.selecteddeparts=r;let t=Array.from(r,(({key:e})=>e));e.record.selecteddeparts=t.join(","),k.value=r.map((e=>({label:e.title,value:e.key})))}e.record.departIds&&!Array.isArray(e.record.departIds)&&(e.record.departIds=e.record.departIds.split(",")),e.record.departIds=""==e.record.departIds?[]:e.record.departIds}e.selectedroles&&(yield W({selectedroles:e.selectedroles})),L([{field:"password",show:!g(b)},{field:"confirmPassword",ifShow:!g(b)},{field:"selectedroles",show:!e.isRole},{field:"departIds",componentProps:{options:k}},{field:"selecteddeparts",show:!(null==e?void 0:e.departDisabled)},{field:"selectedroles",show:!(null==e?void 0:e.departDisabled),componentProps:{api:e.tenantSaas?v:y}},{field:"relTenantIds",componentProps:{disabled:!!e.tenantSaas}}]),!g(b)&&e.tenantSaas&&(yield W({relTenantIds:l().toString()})),"object"==typeof e.record&&W(((e,o)=>{for(var d in o||(o={}))t.call(o,d)&&a(e,d,o[d]);if(r)for(var d of r(o))s.call(o,d)&&a(e,d,o[d]);return e})({},e.record)),D({disabled:!U.value})})))),V=j((()=>g(b)?"编辑用户":"新增用户")),{adaptiveWidth:z}=T();function C(){return o(this,null,(function*(){try{let e=yield B();E({confirmLoading:!0}),1===e.userIdentity&&(e.departIds="");let r=g(b);yield h(e,r),G(),i("success",{isUpdateVal:r,values:e})}finally{E({confirmLoading:!1})}}))}return(e,r)=>(P(),x(g(u),F(e.$attrs,{onRegister:g($),title:V.value,width:g(z),onOk:C,showFooter:U.value,destroyOnClose:""}),{default:O((()=>[_(g(n),{onRegister:g(A)},null,8,["onRegister"])])),_:1},16,["onRegister","title","width","showFooter"]))}});export{D as _};
