var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;import{d as l,e as o,r as i,k as r,s as u,f as c,u as d,E as m,m as f,a2 as p,a3 as g,t as v,A as h,a7 as b,F as y,w,q as x,S as L,Y as C,ad as I,ag as _,Z as O,ab as S,ac as $,a4 as k}from"./vue-vendor.1938e417.js";import{a4 as D,d as E,p as T,a as N,m as U,X as A,I as P,A as j,b as R,ap as q,aq as M,R as B}from"./index.8e60a3c0.js";import{b8 as W,aZ as X,aX as Y,aY as G}from"./vendor.ece5be17.js";const z=`${D().uploadUrl}/sys/common/upload`,F=e=>E.get({url:"/sys/position/list",params:e}),V=e=>E.get({url:"/sys/user/list",params:e}),Z=e=>E.get({url:"/sys/role/list",params:e}),H=e=>E.get({url:"/sys/sysDepart/queryDepartTreeSync",params:e}),J=e=>E.get({url:"/sys/sysDepart/queryTreeList",params:e}),K=e=>E.get({url:"/sys/category/loadTreeData",params:e}),Q=e=>E.get({url:"/sys/category/loadDictItem/",params:e}),ee=e=>E.get({url:"/sys/dict/getDictItems/"+e},{joinTime:!1}),te=e=>E.get({url:"/sys/user/queryUserComponentData",params:e});l({name:"ImagePreview",components:{Image:W,PreviewGroup:W.PreviewGroup},props:{functional:T.bool,imageList:{type:Array}},setup(e){const{prefixCls:t}=N("image-preview");return{prefixCls:t,getImageList:o((()=>{const{imageList:t}=e;return t?t.map((e=>U(e)?{src:e,placeholder:!1}:e)):[]}))}}});var ne=function(e){return e[e.LOADING=0]="LOADING",e[e.DONE=1]="DONE",e[e.FAIL=2]="FAIL",e}(ne||{});const ae={show:{type:Boolean,default:!1},imageList:{type:[Array],default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},se="img-preview",le=l({name:"ImagePreview",props:ae,emits:["img-load","img-error"],setup(e,{expose:t,emit:n}){const a=new Map,s=i({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:ne.LOADING,currentIndex:0,moveX:0,moveY:0,show:e.show}),l=r(null),f=r(null);function p(){!function(){const e=d(l);if(!e)return;e.onmousewheel=h,document.body.addEventListener("DOMMouseScroll",h),document.ondragstart=function(){return!1}}();const{index:t,imageList:n}=e;if(!n||!n.length)throw new Error("imageList is undefined");s.currentIndex=t,x(n[t])}function g(){s.imgScale=1,s.imgRotate=0,s.imgTop=0,s.imgLeft=0}const v=o((()=>{var t;const n=null!=(t=null==e?void 0:e.scaleStep)?t:0;return null!=n&&n?n/100:s.imgScale/10}));function h(e){(e=e||window.event).delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&b(v.value),e.delta<0&&b(-v.value)}function b(e){s.imgScale<=.2&&e<0||(s.imgScale+=e)}function y(e){s.imgRotate+=e}function w(){const e=d(f);e&&(e.onmousemove=null)}function x(t){s.status=ne.LOADING;const l=new Image;l.src=t,l.onload=l=>{if(s.currentUrl!==t){const o=l.composedPath();if(e.rememberState){a.set(s.currentUrl,{scale:s.imgScale,top:s.imgTop,left:s.imgLeft,rotate:s.imgRotate});const n=a.get(t);n?(s.imgScale=n.scale,s.imgTop=n.top,s.imgRotate=n.rotate,s.imgLeft=n.left):(g(),e.defaultWidth&&(s.imgScale=e.defaultWidth/o[0].naturalWidth))}else e.defaultWidth&&(s.imgScale=e.defaultWidth/o[0].naturalWidth);o&&n("img-load",{index:s.currentIndex,dom:o[0],url:t})}s.currentUrl=t,s.status=ne.DONE},l.onerror=e=>{const a=e.composedPath();a&&n("img-error",{index:s.currentIndex,dom:a[0],url:t}),s.status=ne.FAIL}}function L(e){e&&e.stopPropagation(),C()}function C(){s.show=!1,document.body.removeEventListener("DOMMouseScroll",h),document.ondragstart=null}function I(){g()}function _(t){const{currentIndex:n}=s,{imageList:a}=e;"left"===t&&(s.currentIndex--,n<=0&&(s.currentIndex=a.length-1)),"right"===t&&(s.currentIndex++,n>=a.length-1&&(s.currentIndex=0)),x(a[s.currentIndex])}function O(e){e=e||window.event,s.moveX=e.clientX,s.moveY=e.clientY;const t=d(f);t&&(t.onmousemove=S)}function S(e){(e=e||window.event).preventDefault();const t=e.clientX-s.moveX,n=e.clientY-s.moveY;s.imgLeft+=t,s.imgTop+=n,s.moveX=e.clientX,s.moveY=e.clientY}t({resume:I,close:C,prev:_.bind(null,"left"),next:_.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(s.imgScale=e)},setRotate:e=>{s.imgRotate=e}});const $=o((()=>{const{imgScale:t,imgRotate:n,imgTop:a,imgLeft:l}=s;return{transform:`scale(${t}) rotate(${n}deg)`,marginTop:`${a}px`,marginLeft:`${l}px`,maxWidth:e.defaultWidth?"unset":"100%"}})),k=o((()=>{const{imageList:t}=e;return t.length>1}));u((()=>{e.show&&p(),e.imageList&&g()}));const D=t=>{e.maskClosable&&t.target&&t.target.classList.contains(`${se}-content`)&&L(t)},E=()=>{if(!d(k))return null;const{currentIndex:t}=s,{imageList:n}=e;return c("div",{class:`${se}__index`},[t+1,m(" / "),n.length])},T=e=>d(k)?c("div",{class:[`${se}__arrow`,e],onClick:()=>_(e)},[c("left"===e?Y:G,null,null)]):null;return()=>s.show&&c("div",{class:se,ref:l,onMouseup:w,onClick:D},[c("div",{class:`${se}-content`},[c("img",{style:d($),class:[`${se}-image`,s.status===ne.DONE?"":"hidden"],ref:f,src:s.currentUrl,onMousedown:O},null),c("div",{class:`${se}__close`,onClick:L},[c(X,{class:`${se}__close-icon`},null)]),E(),c("div",{class:`${se}__controller`},[c("div",{class:`${se}__controller-item`,onClick:()=>b(-v.value)},[c("img",{src:"/assets/unscale.c552f416.svg"},null)]),c("div",{class:`${se}__controller-item`,onClick:()=>b(v.value)},[c("img",{src:"/assets/scale.44abde22.svg"},null)]),c("div",{class:`${se}__controller-item`,onClick:I},[c("img",{src:"/assets/resume.8f27866b.svg"},null)]),c("div",{class:`${se}__controller-item`,onClick:()=>y(-90)},[c("img",{src:"/assets/unrotate.ef6a2daf.svg"},null)]),c("div",{class:`${se}__controller-item`,onClick:()=>y(90)},[c("img",{src:"/assets/p-rotate.cb8bbfc3.svg"},null)])]),T("left"),T("right")])])}});let oe=null;var ie=(e=>(e.all="all",e.image="image",e.file="file",e))(ie||{});const re={class:"upload-download-handler"},ue={class:"upload-mover-handler"},ce=l({__name:"UploadItemActions",props:{element:{type:HTMLElement,required:!0},fileList:{type:Object,required:!0},mover:{type:Boolean,required:!0},download:{type:Boolean,required:!0},emitValue:{type:Function,required:!0}},setup(e){const t=e,{createMessage:n}=j(),a=o((()=>d(t.fileList)));function s(){let e=r();-1!==e?i(e,0!==e?e-1:d(a).length-1):n.warn("移动失败："+e)}function l(){let e=r();-1!==e?e!=d(a).length-1?i(e,e+1):i(e,0):n.warn("移动失败："+e)}function i(e,n){if(e!==n){let s=[...d(a)],l=s[e];s[e]=s[n],s[n]=l,t.emitValue(s.map((e=>e.url)).join(","))}}function r(){var e,n;const s=null==(n=null==(e=t.element)?void 0:e.getElementsByTagName("img")[0])?void 0:n.src;if(s){const e=d(a);for(let t=0;t<e.length;t++){let n=e[t].url;const a=s.replace(window.location.origin,"");if(n===a||encodeURI(n)===a)return t}}return-1}function u(){var e,n;const a=null==(n=null==(e=t.element)?void 0:e.getElementsByTagName("img")[0])?void 0:n.src;window.open(a)}return(t,n)=>(p(),g(y,null,[v(b("div",re,[b("a",{class:"download",title:"下载",onClick:u},[c(d(P),{icon:"ant-design:download"})])],512),[[h,e.download]]),v(b("div",ue,[b("a",{title:"向前移动",onClick:s},[c(d(P),{icon:"ant-design:arrow-left"})]),b("a",{title:"向后移动",onClick:l},[c(d(P),{icon:"ant-design:arrow-right"})])],512),[[h,e.mover&&a.value.length>1]])],64))}}),de={key:0},me={class:"ant-upload-text"},fe="ant-upload-list-item",pe=l({__name:"JUpload",props:{value:T.oneOfType([T.string,T.array]),text:T.string.def("上传"),fileType:T.string.def(ie.all),bizPath:T.string.def("temp"),returnUrl:T.bool.def(!0),maxCount:T.number.def(0),buttonVisible:T.bool.def(!0),multiple:T.bool.def(!0),mover:T.bool.def(!0),download:T.bool.def(!0),removeConfirm:T.bool.def(!1),beforeUpload:T.func,disabled:T.bool.def(!1)},emits:["change","update:value"],setup(e,{expose:l,emit:u}){const m=e,{createMessage:v,createConfirm:h}=j(),{prefixCls:D}=N("j-upload"),E=R(),T=i({[q.TOKEN]:M()}),U=r([]),W=r(!0),X=r(),Y=o((()=>m.maxCount>0&&U.value.length>=m.maxCount)),G=o((()=>m.fileType===ie.image)),F=o((()=>{const e=Object.assign({},m,d(E));return e.name="file",e.listType=G.value?"picture-card":"text",e.class=[e.class,{"upload-disabled":m.disabled}],e.data=((e,l)=>{for(var o in l||(l={}))n.call(l,o)&&s(e,o,l[o]);if(t)for(var o of t(l))a.call(l,o)&&s(e,o,l[o]);return e})({biz:m.bizPath},e.data),e.beforeUpload||(e.beforeUpload=J),G.value&&!e.accept&&(e.accept="image/*"),e}));function V(){if(!G.value)return;const e=X.value?X.value.getElementsByClassName(fe):null;if(e&&0!==e.length)for(const t of e){"true"===t.getAttribute("data-has-actions")||t.addEventListener("mouseover",Z)}}function Z(e){const t=(()=>{for(const t of e.path){if(t.classList.contains(fe))return t;if(t.classList.contains(`${D}-container`))return null}return null})();if(!t)return;const n=t.getElementsByClassName("ant-upload-list-item-actions");if(!n||0===n.length)return;const a=document.createElement("div");a.className="upload-actions-container",L(ce,{element:t,fileList:U,mover:m.mover,download:m.download,emitValue:te}).mount(a),n[0].appendChild(a),t.setAttribute("data-has-actions","true"),t.removeEventListener("mouseover",Z)}function H(e){if(!e||0==e.length)return void(U.value=[]);let t=[];for(const n of e.split(",")){let e=B(n);t.push({uid:ne(),name:ae(n),status:"done",url:e,response:{status:"history",message:n}})}U.value=t}function J(e){return W.value=!0,G.value&&e.type.indexOf("image")<0?(v.warning("请上传图片"),W.value=!1,!1):"function"!=typeof m.beforeUpload||m.beforeUpload(e)}function K(){return!m.removeConfirm||new Promise((e=>{h({title:"删除",content:`确定要删除这${G.value?"张图片":"个文件"}吗？`,iconType:"warning",onOk:()=>e(!0),onCancel:()=>e(!1)})}))}function Q(e){e.file.status||!1!==W.value||e.fileList.pop();let t=e.fileList;if(m.maxCount>0){if(t.length>=m.maxCount){if(!(m.maxCount-t.length>=0))return;t=t.slice(-m.maxCount)}}if("done"===e.file.status?e.file.response.success&&(t=t.map((e=>{if(e.response){let t=e.response.message;e.url=B(t)}return e}))):"error"===e.file.status&&v.error(`${e.file.name} 上传失败.`),U.value=t,"done"===e.file.status||"removed"===e.file.status)if(m.returnUrl)!function(){let e=U.value,t="";e&&0!=e.length||(t="");let n=[];for(const a of e){if("done"!==a.status)return;n.push(a.response.message)}n.length>0&&(t=n.join(","));te(t)}();else{let e=[];for(const n of t){if("done"!==n.status)return;{let t={fileName:n.name,filePath:n.response.message,fileSize:n.size};e.push(t)}}te(e)}}function ee(e){G.value?function(e){var t;if(!A)return;const n={},a=document.createElement("div");Object.assign(n,{show:!0,index:0,scaleStep:100},e),oe=c(le,n),f(oe,a),document.body.appendChild(a),null==(t=oe.component)||t.exposed}({imageList:[e.url],maskClosable:!0}):window.open(e.url)}function te(e){u("change",e),u("update:value",e)}function ne(){return"-"+parseInt(1e4*Math.random()+1,10)}function ae(e){if(e.lastIndexOf("\\")>=0){let t=new RegExp("\\\\","g");e=e.replace(t,"/")}return e.substring(e.lastIndexOf("/")+1)}return w((()=>m.value),(e=>{Array.isArray(e)?m.returnUrl?H(e.join(",")):function(e){if(!e||0==e.length)return void(U.value=[]);let t=[];for(const n of e){let e=B(n.filePath);t.push({uid:ne(),name:n.fileName,url:e,status:"done",response:{status:"history",message:n.filePath}})}U.value=t}(e):H(e)}),{immediate:!0}),w(U,(()=>x((()=>V()))),{immediate:!0}),l({addActionsListener:V}),(t,n)=>{const a=C("a-button"),s=C("a-upload");return p(),g("div",{ref_key:"containerRef",ref:X,class:k(`${d(D)}-container`)},[c(s,$({headers:T,multiple:e.multiple,action:d(z),fileList:U.value,disabled:e.disabled},F.value,{onRemove:K,onChange:Q,onPreview:ee}),{default:I((()=>[G.value?(p(),g(y,{key:0},[Y.value?O("",!0):(p(),g("div",de,[c(d(P),{icon:"ant-design:plus-outlined"}),b("div",me,_(e.text),1)]))],64)):e.buttonVisible?(p(),S(a,{key:1,disabled:Y.value||e.disabled},{default:I((()=>[c(d(P),{icon:"ant-design:upload-outlined"}),b("span",null,_(e.text),1)])),_:1},8,["disabled"])):O("",!0)])),_:1},16,["headers","multiple","action","fileList","disabled"])],2)}}});export{ie as U,pe as _,F as a,Z as b,J as c,Q as d,ee as e,te as f,V as g,K as l,H as q,z as u};
