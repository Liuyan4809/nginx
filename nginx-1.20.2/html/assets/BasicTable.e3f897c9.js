var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,n,l)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[n]=l,s=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&i(e,n,t[n]);if(l)for(var n of l(t))a.call(t,n)&&i(e,n,t[n]);return e},r=(e,l)=>t(e,n(l)),c=(e,t,n)=>new Promise(((l,o)=>{var a=e=>{try{s(n.next(e))}catch(t){o(t)}},i=e=>{try{s(n.throw(e))}catch(t){o(t)}},s=e=>e.done?l(e.value):Promise.resolve(e.value).then(a,i);s((n=n.apply(e,t)).next())}));import{aW as u,aX as d,aY as f,z as p,aw as g,$ as m,a7 as h,a2 as b,a3 as v,a4 as C,P as y,aZ as S,a_ as w,Z as x,o as k,b as R,s as T,k as P,aH as I,a$ as O,u as F,b0 as _,T as K,b1 as D,ae as A,aF as E,b2 as M,H as $,G as B,b3 as H,b4 as L,b5 as j,b6 as z,ad as V}from"./vendor.ece5be17.js";import{B as N,u as W}from"./useForm.0379175d.js";import{P as q,a as G,A as U,b as Z,u as J,D as Y,I as Q,c as X,R as ee,F as te,d as ne,e as le,f as oe,g as ae}from"./BasicForm.vue_vue_type_style_index_0_lang.daafa440.js";import{_ as ie,j as se,a as re,u as ce,k as ue,C as de,p as fe,i as pe,e as ge,l as me,m as he,t as be,n as ve,o as Ce,q as ye,r as Se,s as we,v as xe,x as ke,y as Re,z as Te,A as Pe,S as Ie,I as Oe,D as Fe,E as _e,B as Ke,F as De,G as Ae,H as Ee}from"./index.8e60a3c0.js";import{d as Me,Y as $e,a2 as Be,a3 as He,R as Le,E as je,ag as ze,f as Ve,e as Ne,ab as We,ad as qe,a4 as Ge,Z as Ue,F as Ze,k as Je,w as Ye,u as Qe,n as Xe,s as et,q as tt,J as nt,v as lt,t as ot,A as at,a7 as it,ac as st,r as rt,o as ct,K as ut,H as dt,ai as ft,c as pt,ak as gt,aj as mt,al as ht}from"./vue-vendor.1938e417.js";import{u as bt}from"./useWindowSizeFn.6b4ca4c0.js";import"./index.a6220f15.js";import{u as vt}from"./BasicModal.cadf9873.js";const Ct="PageWrapperFixedHeight",yt=Me({name:"EditTableHeaderIcon",components:{FormOutlined:u},props:{title:{type:String,default:""}}});const St=Me({name:"TableHeaderCell",components:{EditTableHeaderCell:ie(yt,[["render",function(e,t,n,l,o,a){const i=$e("FormOutlined");return Be(),He("span",null,[Le(e.$slots,"default"),je(" "+ze(e.title)+" ",1),Ve(i)])}]]),BasicHelp:se},props:{column:{type:Object,default:()=>({})}},setup(e){const{prefixCls:t}=re("basic-table-header-cell");return{prefixCls:t,getIsEdit:Ne((()=>{var t;return!!(null==(t=e.column)?void 0:t.edit)})),getTitle:Ne((()=>{var t,n;return(null==(t=e.column)?void 0:t.customTitle)||(null==(n=e.column)?void 0:n.title)})),getHelpMessage:Ne((()=>{var t;return null==(t=e.column)?void 0:t.helpMessage}))}}}),wt={key:1};const xt=ie(St,[["render",function(e,t,n,l,o,a){const i=$e("EditTableHeaderCell"),s=$e("BasicHelp");return Be(),He(Ze,null,[e.getIsEdit?(Be(),We(i,{key:0},{default:qe((()=>[je(ze(e.getTitle),1)])),_:1})):(Be(),He("span",wt,ze(e.getTitle),1)),e.getHelpMessage?(Be(),We(s,{key:2,text:e.getHelpMessage,class:Ge(`${e.prefixCls}__help`)},null,8,["text","class"])):Ue("",!0)],64)}]]);function kt({page:e,type:t,originalElement:n}){return"prev"===t?0===e?null:Ve(d,null,null):"next"===t?1===e?null:Ve(f,null,null):n}const Rt=new Map;Rt.set("Input",p),Rt.set("InputNumber",g),Rt.set("Select",m),Rt.set("ApiSelect",U),Rt.set("ApiTreeSelect",Z),Rt.set("Switch",h),Rt.set("Checkbox",b),Rt.set("DatePicker",v),Rt.set("TimePicker",C);const{t:Tt}=ce();function Pt(e){return e.includes("Input")?Tt("common.inputText"):e.includes("Picker")||e.includes("Select")||e.includes("Checkbox")||e.includes("Radio")||e.includes("Switch")||e.includes("DatePicker")||e.includes("TimePicker")?Tt("common.chooseText"):""}const It=Me({name:"EditableCell",components:{FormOutlined:u,CloseOutlined:S,CheckOutlined:w,CellComponent:({component:e="Input",rule:t=!0,ruleMessage:n,popoverVisible:l,getPopupContainer:o},{attrs:a})=>{const i=Rt.get(e),r=Xe(i,a);return t?Xe(y,s({overlayClassName:"edit-cell-rule-popover",visible:!!l},o?{getPopupContainer:o}:{}),{default:()=>r,content:()=>n}):r},ASpin:x},directives:{clickOutside:de},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:fe.number},setup(e){const t=J(),n=Je(!1),l=Je(),o=Je(!1),a=Je(""),i=Je([]),u=Je(e.value),d=Je(e.value),f=Je(!1),{prefixCls:p}=re("editable-cell"),g=Ne((()=>{var t;return(null==(t=e.column)?void 0:t.editComponent)||"Input"})),m=Ne((()=>{var t;return null==(t=e.column)?void 0:t.editRule})),h=Ne((()=>Qe(a)&&Qe(o))),b=Ne((()=>{const e=Qe(g);return["Checkbox","Switch"].includes(e)})),v=Ne((()=>{var n,l;const o=null!=(l=null==(n=e.column)?void 0:n.editComponentProps)?l:{},a={};"ApiSelect"===Qe(g)&&(a.cache=!0);const i=Qe(b),c=i?"checked":"value",d=Qe(u),f=i?pe(d)&&ue(d)?d:!!d:d;return r(s(s({size:"small",getPopupContainer:()=>{var e;return null!=(e=Qe(null==t?void 0:t.wrapRef.value))?e:document.body},getCalendarContainer:()=>{var e;return null!=(e=Qe(null==t?void 0:t.wrapRef.value))?e:document.body},placeholder:Pt(Qe(g))},a),k(o,"onChange")),{[c]:f})})),C=Ne((()=>{var t,n;const{editComponentProps:l,editValueMap:o}=e.column,a=Qe(u);if(o&&ge(o))return o(a);if(!Qe(g).includes("Select"))return a;const s=(null!=(t=null==l?void 0:l.options)?t:Qe(i)||[]).find((e=>`${e.value}`==`${a}`));return null!=(n=null==s?void 0:s.label)?n:a})),y=Ne((()=>Qe(b)||Qe(w)?{}:{width:"calc(100% - 48px)"})),S=Ne((()=>{const{align:t="center"}=e.column;return`edit-cell-align-${t}`})),w=Ne((()=>{const{editable:t}=e.record||{};return!!t}));function x(){return c(this,null,(function*(){const{column:t,record:n}=e,{editRule:l}=t,i=Qe(u);if(l){if(ue(l)&&!i&&!pe(i)){o.value=!0;const e=Qe(g);return a.value=Pt(e),!1}if(ge(l)){const e=yield l(i,n);return e?(a.value=e,o.value=!0,!1):(a.value="",!0)}}return a.value="",!0}))}function P(l=!0,o=!0){return c(this,null,(function*(){var a;if(o){if(!(yield x()))return!1}const{column:i,index:s,record:r}=e;if(!r)return!1;const{key:c,dataIndex:d}=i,p=Qe(u);if(!c||!d)return;const g=d||c;if(!r.editable){const{getBindValues:e}=t,{beforeEditSubmit:n,columns:l}=Qe(e);if(n&&ge(n)){f.value=!0;const e=l.map((e=>e.dataIndex)).filter((e=>!!e));let t=!0;try{t=yield n({record:R(r,e),index:s,key:c,value:p})}catch(m){t=!1}finally{f.value=!1}if(!1===t)return}}T(r,g,p),l&&(null==(a=t.emit)||a.call(t,"edit-end",{record:r,index:s,key:c,value:p})),n.value=!1}))}function I(){var l;n.value=!1,u.value=d.value;const{column:o,index:a,record:i}=e,{key:s,dataIndex:r}=o;null==(l=t.emit)||l.call(t,"edit-cancel",{record:i,index:a,key:r||s,value:Qe(u)})}function O(t,n){var l;e.record&&(me(e.record[t])?null==(l=e.record[t])||l.push(n):e.record[t]=[n])}return et((()=>{d.value=e.value,u.value=e.value})),et((()=>{const{editable:t}=e.column;(ue(t)||ue(Qe(w)))&&(n.value=!!t||Qe(w))})),e.record&&(O("submitCbs",P),O("validCbs",x),O("cancelCbs",I),e.column.dataIndex&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.dataIndex]=u),e.record.onCancelEdit=()=>{var t,n;me(null==(t=e.record)?void 0:t.cancelCbs)&&(null==(n=e.record)||n.cancelCbs.forEach((e=>e())))},e.record.onSubmitEdit=()=>c(this,null,(function*(){var n,l,o,a,i;if(me(null==(n=e.record)?void 0:n.submitCbs)){if(!(null==(o=null==(l=e.record)?void 0:l.onValid)?void 0:o.call(l)))return;return((null==(a=e.record)?void 0:a.submitCbs)||[]).forEach((e=>e(!1,!1))),null==(i=t.emit)||i.call(t,"edit-row-end"),!0}}))),{isEdit:n,prefixCls:p,handleEdit:function(){var t;Qe(w)||Qe(null==(t=e.column)?void 0:t.editRow)||(a.value="",n.value=!0,tt((()=>{var e;const t=Qe(l);null==(e=null==t?void 0:t.focus)||e.call(t)})))},currentValueRef:u,handleSubmit:P,handleChange:function(n){return c(this,arguments,(function*(n){var l,o,a;const i=Qe(g);n?(null==n?void 0:n.target)&&Reflect.has(n.target,"value")?u.value=n.target.value:"Checkbox"===i?u.value=n.target.checked:(he(n)||ue(n)||pe(n)||me(n))&&(u.value=n):u.value=n;const s=null==(o=null==(l=e.column)?void 0:l.editComponentProps)?void 0:o.onChange;s&&ge(s)&&s(...arguments),null==(a=t.emit)||a.call(t,"edit-change",{column:e.column,value:Qe(u),record:nt(e.record)}),x()}))},handleCancel:I,elRef:l,getComponent:g,getRule:m,onClickOutside:function(){var t;if((null==(t=e.column)?void 0:t.editable)||Qe(w))return;Qe(g).includes("Input")&&I()},ruleMessage:a,getRuleVisible:h,getComponentProps:v,handleOptionsChange:function(t){var n,l;const{replaceFields:o}=null!=(l=null==(n=e.column)?void 0:n.editComponentProps)?l:{};if("ApiTreeSelect"===Qe(g)){const{title:e="title",value:n="value",children:l="children"}=o||{};let a=be(t,{children:l});a=a.map((t=>({label:t[e],value:t[n]}))),i.value=a}else i.value=t},getWrapperStyle:y,getWrapperClass:S,getRowEditable:w,getValues:C,handleEnter:function(){return c(this,null,(function*(){var t;(null==(t=e.column)?void 0:t.editRow)||P()}))},handleSubmitClick:function(){P()},spinning:f}}}),Ot=["title"];const Ft=ie(It,[["render",function(e,t,n,l,o,a){var i;const s=$e("FormOutlined"),r=$e("CellComponent"),c=$e("CheckOutlined"),u=$e("CloseOutlined"),d=$e("a-spin"),f=lt("click-outside");return Be(),He("div",{class:Ge(e.prefixCls)},[ot(it("div",{class:Ge({[`${e.prefixCls}__normal`]:!0,"ellipsis-cell":e.column.ellipsis}),onClick:t[0]||(t[0]=(...t)=>e.handleEdit&&e.handleEdit(...t))},[it("div",{class:"cell-content",title:e.column.ellipsis&&null!=(i=e.getValues)?i:""},ze(e.getValues?e.getValues:" "),9,Ot),e.column.editRow?Ue("",!0):(Be(),We(s,{key:0,class:Ge(`${e.prefixCls}__normal-icon`)},null,8,["class"]))],2),[[at,!e.isEdit]]),e.isEdit?(Be(),We(d,{key:0,spinning:e.spinning},{default:qe((()=>[ot((Be(),He("div",{class:Ge(`${e.prefixCls}__wrapper`)},[Ve(r,st(e.getComponentProps,{component:e.getComponent,style:e.getWrapperStyle,popoverVisible:e.getRuleVisible,rule:e.getRule,ruleMessage:e.ruleMessage,class:e.getWrapperClass,ref:"elRef",onChange:e.handleChange,onOptionsChange:e.handleOptionsChange,onPressEnter:e.handleEnter}),null,16,["component","style","popoverVisible","rule","ruleMessage","class","onChange","onOptionsChange","onPressEnter"]),e.getRowEditable?Ue("",!0):(Be(),He("div",{key:0,class:Ge(`${e.prefixCls}__action`)},[Ve(c,{class:Ge([`${e.prefixCls}__icon`,"mx-2"]),onClick:e.handleSubmitClick},null,8,["class","onClick"]),Ve(u,{class:Ge(`${e.prefixCls}__icon `),onClick:e.handleCancel},null,8,["class","onClick"])],2))],2)),[[f,e.onClickOutside]])])),_:1},8,["spinning"])):Ue("",!0)],2)}]]);function _t(e,t){const{key:n,dataIndex:l,children:o}=e;e.align=e.align||Y,t&&(n||(e.key=l),ue(e.ellipsis)||Object.assign(e,{ellipsis:t})),o&&o.length&&Kt(o,!!t)}function Kt(e,t){e&&e.forEach((e=>{const{children:n}=e;_t(e,t),Kt(n,t)}))}function Dt(e,t){const n=Je(Qe(e).columns);let l=Qe(e).columns;const o=Ne((()=>{const l=P(Qe(n));if(function(e,t,n){const{t:l}=ce(),{showIndexColumn:o,indexColumnProps:a,isTreeTable:i}=Qe(e);let r=!1;if(Qe(i))return;if(n.forEach((()=>{const e=n.findIndex((e=>e.flag===Q));o?r=-1===e:o||-1===e||n.splice(e,1)})),!r)return;const c=n.some((e=>"left"===e.fixed));n.unshift(s(s({flag:Q,width:50,title:l("component.table.index"),align:"center",customRender:({index:e})=>{const n=Qe(t);if(ue(n))return`${e+1}`;const{current:l=1,pageSize:o=q}=n;return((l<1?1:l)-1)*o+e+1}},c?{fixed:"left"}:{}),a))}(e,t,l),function(e,t){const{actionColumn:n,showActionColumn:l}=Qe(e);if(!n||!l)return;const o=t.findIndex((e=>e.flag===X));-1===o&&t.push(r(s(s({},t[o]),n),{flag:X}))}(e,l),!l)return[];const{ellipsis:o}=Qe(e);return l.forEach((e=>{const{customRender:t,slots:n}=e;_t(e,Reflect.has(e,"ellipsis")?!!e.ellipsis:!!o&&!t&&!n)})),l}));const{hasPermission:a}=ve(),i=Ne((()=>{const e=At(Qe(o));return P(e).filter((e=>a(e.auth)&&function(e){const t=e.ifShow;let n=!0;return ue(t)&&(n=t),ge(t)&&(n=t(e)),n}(e))).map((e=>{const{slots:t,customRender:n,format:l,edit:o,editRow:a,flag:i,title:s}=e;t&&(null==t?void 0:t.title)||(e.customTitle=e.title,Reflect.deleteProperty(e,"title")),e.children&&(e.title=s);const r=[Q,X].includes(i);return n||!l||o||r||(e.customRender=({text:e,record:t,index:n})=>function(e,t,n,l){if(!t)return e;if(ge(t))return t(e,n,l);try{const n="date|";if(he(t)&&t.startsWith(n)){const l=t.replace(n,"");return l?Ce(e,l):e}if(ye(t))return t.get(e)}catch(o){return e}}(e,l,t,n)),!o&&!a||r||(e.customRender=function(e){return({text:t,record:n,index:l})=>(n.onValid=()=>c(this,null,(function*(){if(me(null==n?void 0:n.validCbs)){const e=((null==n?void 0:n.validCbs)||[]).map((e=>e()));return(yield Promise.all(e)).every((e=>!!e))}return!1})),n.onEdit=(e,t=!1)=>c(this,null,(function*(){var l,o;return t||(n.editable=e),!e&&t?!!(yield n.onValid())&&(!!(yield null==(l=n.onSubmitEdit)?void 0:l.call(n))&&(n.editable=!1,!0)):(e||t||null==(o=n.onCancelEdit)||o.call(n),!0)})),Xe(Ft,{value:t,record:n,column:e,index:l}))}(e)),rt(e)}))}));return Ye((()=>Qe(e).columns),(e=>{var t;n.value=e,l=null!=(t=null==e?void 0:e.filter((e=>!e.flag)))?t:[]})),{getColumnsRef:o,getCacheColumns:function(){return l},getColumns:function(e){const{ignoreIndex:t,ignoreAction:n,sort:l}=e||{};let a=nt(Qe(o));return t&&(a=a.filter((e=>e.flag!==Q))),n&&(a=a.filter((e=>e.flag!==X))),l&&(a=At(a)),a},setColumns:function(e){const t=P(e);if(!me(t))return;if(t.length<=0)return void(n.value=[]);const o=t[0],a=l.map((e=>e.dataIndex));if(he(o)||me(o)){const e=t.map((e=>e.toString())),o=[];l.forEach((t=>{var n;o.push(r(s({},t),{defaultHidden:!e.includes((null==(n=t.dataIndex)?void 0:n.toString())||t.key)}))})),I(a,t)||o.sort(((t,n)=>{var l,o;return e.indexOf(null==(l=t.dataIndex)?void 0:l.toString())-e.indexOf(null==(o=n.dataIndex)?void 0:o.toString())})),n.value=o}else n.value=t},getViewColumns:i,setCacheColumnsByField:function(e,t){e&&t&&l.forEach((n=>{n.dataIndex!==e||Object.assign(n,t)}))}}}function At(e){const t=[],n=[],l=[];for(const o of e)"left"!==o.fixed?"right"!==o.fixed?l.push(o):n.push(o):t.push(o);return[...t,...l,...n].filter((e=>!e.defaultHidden))}function Et(e,{getPaginationInfo:t,setPagination:n,setLoading:l,validate:o,clearSelectedRowKeys:a,tableData:i},r){const u=rt({sortInfo:{},filterInfo:{}}),d=Je([]),f=Je({});function p(e){e&&Array.isArray(e)&&e.forEach((e=>{e[ee]||(e[ee]=Se()),e.children&&e.children.length&&p(e.children)}))}et((()=>{i.value=Qe(d)})),Ye((()=>Qe(e).dataSource),(()=>{const{dataSource:t,api:n}=Qe(e);!n&&t&&(d.value=t)}),{immediate:!0});const g=Ne((()=>Qe(e).autoCreateKey&&!Qe(e).rowKey)),m=Ne((()=>{const{rowKey:t}=Qe(e);return Qe(g)?ee:t})),h=Ne((()=>{const e=Qe(d);if(!e||0===e.length)return Qe(d);if(Qe(g)){const t=e[0],n=e[e.length-1];if(t&&n&&(!t[ee]||!n[ee])){const e=P(Qe(d));e.forEach((e=>{e[ee]||(e[ee]=Se()),e.children&&e.children.length&&p(e.children)})),d.value=e}}return Qe(d)}));function b(t){if(!d.value||0==d.value.length)return;const n=Qe(m);if(!n)return;const{childrenColumnName:l="children"}=Qe(e);return(e=>{let o;return e.some((function e(a){if("function"==typeof n){if(n(a)===t)return o=a,!0}else if(Reflect.has(a,n)&&a[n]===t)return o=a,!0;return a[l]&&a[l].some(e)})),o})(d.value)}function v(a){return c(this,null,(function*(){var i,c,p;const{api:g,searchInfo:m,defSort:h,fetchSetting:b,beforeFetch:C,afterFetch:y,useSearchForm:S,pagination:w}=Qe(e);if(g&&ge(g))try{l(!0);const{pageField:e,sizeField:x,listField:k,totalField:R}=Object.assign({},te,b);let T={};const{current:P=1,pageSize:I=q}=Qe(t);ue(w)&&!w||ue(t)?T={}:(T[e]=a&&a.page||P,T[x]=I);const{sortInfo:F={},filterInfo:_}=u;let K=s(s(s(s(s(s(s(s(s({},T),S?yield o():{}),m),h),null!=(i=null==a?void 0:a.searchInfo)?i:{}),F),_),null!=(c=null==a?void 0:a.sortInfo)?c:{}),null!=(p=null==a?void 0:a.filterInfo)?p:{});C&&ge(C)&&(K=(yield C(K))||K);const D=yield g(K);f.value=D;const A=Array.isArray(D);let E=A?D:O(D,k);const M=A?0:O(D,R);if(M){const e=Math.ceil(Number(M)/I);if(P>e)return n({current:e}),yield v(a)}return y&&ge(y)&&(E=(yield y(E))||E),d.value=E,n({total:Number(M)||0}),a&&a.page&&n({current:a.page||1}),r("fetch-success",{items:Qe(E),total:Number(M)}),E}catch(x){r("fetch-error",x),d.value=[],n({total:0})}finally{l(!1)}}))}return ct((()=>{we((()=>{Qe(e).immediate&&v()}),16)})),{getDataSourceRef:h,getDataSource:function(){return h.value},getRawDataSource:function(){return f.value},getRowKey:m,setTableData:function(e){d.value=e},getAutoCreateKey:g,fetch:v,reload:function(e){return c(this,null,(function*(){return yield v(e)}))},updateTableData:function(e,t,n){return c(this,null,(function*(){return d.value[e]&&(d.value[e][t]=n),d.value[e]}))},updateTableDataRecord:function(e,t){const n=b(e);if(n){for(const e in n)Reflect.has(t,e)&&(n[e]=t[e]);return n}},deleteTableDataRecord:function(t){var l,o,a;if(!d.value||0==d.value.length)return;const i=Qe(m);if(!i)return;const s=Array.isArray(t)?t:[t];for(const n of s){let t=d.value.findIndex((e=>{let t;return t="function"==typeof i?i(e):i,e[t]===n}));t>=0&&d.value.splice(t,1),t=null==(l=Qe(e).dataSource)?void 0:l.findIndex((e=>{let t;return t="function"==typeof i?i(e):i,e[t]===n})),void 0!==t&&-1!==t&&(null==(o=Qe(e).dataSource)||o.splice(t,1))}n({total:null==(a=Qe(e).dataSource)?void 0:a.length})},insertTableDataRecord:function(e,t){var n;return t=null!=t?t:null==(n=d.value)?void 0:n.length,Qe(d).splice(t,0,e),Qe(d)},findTableDataRecord:b,handleTableChange:function(t,l,o){const{clearSelectOnPageChange:i,sortFn:s,filterFn:r}=Qe(e);i&&a(),n(t);const c={};if(o&&ge(s)){const e=s(o);u.sortInfo=e,c.sortInfo=e}if(l&&ge(r)){const e=r(l);u.filterInfo=e,c.filterInfo=e}v(c)}}}function Mt(e){let t;ct((()=>{e(),tt((()=>{t=!0}))})),ut((()=>{t&&e()}))}function $t(e,t,n,l,o){const a=Je(null),i=vt(),r=F(d,100),u=Ne((()=>{const{canResize:t,scroll:n}=Qe(e);return t&&!(n||{}).y}));function d(){tt((()=>{m()}))}let f,p,g;function m(){return c(this,null,(function*(){var n,l;const{resizeHeightOffset:s,pagination:r,maxHeight:c,minHeight:d}=Qe(e),m=Qe(o),h=Qe(t);if(!h)return;const b=h.$el;if(!b)return;if(!g&&(g=b.querySelector(".ant-table-tbody"),!g))return;const v=g.scrollHeight>g.clientHeight,C=g.scrollWidth>g.clientWidth;if(v?b.classList.contains("hide-scrollbar-y")&&b.classList.remove("hide-scrollbar-y"):!b.classList.contains("hide-scrollbar-y")&&b.classList.add("hide-scrollbar-y"),C?b.classList.contains("hide-scrollbar-x")&&b.classList.remove("hide-scrollbar-x"):!b.classList.contains("hide-scrollbar-x")&&b.classList.add("hide-scrollbar-x"),g.style.height="unset",!Qe(u)||0===m.length)return;yield tt();const y=b.querySelector(".ant-table-thead");if(!y)return;const{bottomIncludeBody:S}=ke(y);let w=2;if(ue(r))w=-8;else if(f=b.querySelector(".ant-pagination"),f){w+=f.offsetHeight||0}else w+=24;let x=0;if(!ue(r))if(p){x+=p.offsetHeight||0}else p=b.querySelector(".ant-table-footer");let k=0;y&&(k=y.offsetHeight);let R=S-(s||0)-32-w-x-k;R=null!=(n=R<d?d:R)?n:R,R=null!=(l=R>c?c:R)?l:R,function(e){var t;a.value=e,null==(t=null==i?void 0:i.redoModalHeight)||t.call(i)}(R),g.style.height=`${R}px`}))}Ye((()=>{var e;return[Qe(u),null==(e=Qe(o))?void 0:e.length]}),(()=>{r()}),{flush:"post"}),bt(m,280),Mt((()=>{m(),tt((()=>{r()}))}));const h=Ne((()=>{var e,o;let a=0;Qe(l)&&(a+=60);const i=Qe(n).filter((e=>!e.defaultHidden));i.forEach((e=>{a+=Number.parseInt(e.width)||0}));const s=i.filter((e=>!Reflect.has(e,"width"))).length;0!==s&&(a+=150*s);const r=Qe(t);return(null!=(o=null==(e=null==r?void 0:r.$el)?void 0:e.offsetWidth)?o:0)>a?"100%":a}));return{getScrollRef:Ne((()=>{const t=Qe(a),{canResize:n,scroll:l}=Qe(e);return s({x:Qe(h),y:n?t:null,scrollToFirstRowOnChange:!1},l)})),redoHeight:d}}function Bt(e,{setSelectedRowKeys:t,getSelectRowKeys:n,getAutoCreateKey:l,clearSelectedRowKeys:o,emit:a}){return{customRow:(i,s)=>({onClick:r=>{null==r||r.stopPropagation(),function(){var a;const{rowSelection:s,rowKey:c,clickToRowSelect:u}=Qe(e);if(!s||!u)return;const d=n(),f=function(e,t,n){return!t||n?e[ee]:he(t)?e[t]:ge(t)?e[t(e)]:null}(i,c,Qe(l));if(!f)return;if("checkbox"===s.type){const e=null==(a=r.composedPath)?void 0:a.call(r).find((e=>"TR"===e.tagName));if(!e)return;const n=e.querySelector("input[type=checkbox]");if(!n||n.hasAttribute("disabled"))return;if(!d.includes(f))return void t([...d,f]);const l=d.findIndex((e=>e===f));return d.splice(l,1),void t(d)}if("radio"===s.type){if(!d.includes(f))return d.length&&o(),void t([f]);o()}}(),a("row-click",i,s,r)},onDblclick:e=>{a("row-dbClick",i,s,e)},onContextmenu:e=>{a("row-contextmenu",i,s,e)},onMouseenter:e=>{a("row-mouseenter",i,s,e)},onMouseleave:e=>{a("row-mouseleave",i,s,e)}})}}function Ht(e,t,n){let l=!1;const o=J(),a=Re(),{createMessage:i}=Pe(),s=Ne((()=>{var e;let{fullPath:t}=Te.currentRoute.value,n=t.replace(/[\/\\]/g,"_"),l=null==(e=o.getBindValues.value.tableSetting)?void 0:e.cacheKey;return l&&(n+=":"+l),"columnCache:"+n}));et((()=>{o.getColumns().length&&function(){c(this,null,(function*(){if(l)return;l=!0;let i=a.get(s.value);if(i&&i.checkedList){const{checkedList:l,sortedList:a,sortableOrder:s,checkIndex:r}=i;yield tt(),e.sortableOrder.value=s,e.state.checkedList=l,e.plainSortOptions.value.sort(((e,t)=>a.indexOf(e.value)-a.indexOf(t.value))),l.sort(((e,t)=>a.indexOf(e)-a.indexOf(t))),r&&o.setProps({showIndexColumn:!0}),t(l),function(t){c(this,null,(function*(){const{fixedColumns:l}=t,o=e.plainOptions.value;for(const e of o){let t=l.find((t=>t.key===(e.key||e.dataIndex)));t&&(yield tt(),n(e,t.fixed))}}))}(i)}}))}()}));const r=/^(true|left|right)$/;function u(){var t;let n=[];const l=e.plainOptions.value;for(const e of l)r.test((null!=(t=e.fixed)?t:"").toString())&&n.push({key:e.key||e.dataIndex,fixed:!0===e.fixed?"left":e.fixed});return n}return{saveSetting:function(){const{checkedList:t}=e.state,n=Qe(e.plainSortOptions).map((e=>e.value));a.set(s.value,{checkedList:t,sortedList:n,checkIndex:Qe(e.checkIndex),sortableOrder:Qe(e.sortableOrder),fixedColumns:u()}),i.success("保存成功"),e.popoverVisible.value=!1},resetSetting:function(){return c(this,null,(function*(){yield function(){return c(this,null,(function*(){var t;const l=e.plainOptions.value;for(const e of l)e.fixed,r.test((null!=(t=e.fixed)?t:"").toString())&&(yield tt(),n(e,null))}))}(),a.remove(s.value),i.success("重置成功")}))}}}const Lt=ie(Me({name:"ColumnSetting",props:{isMobile:Boolean},components:{SettingOutlined:_,Popover:y,Tooltip:K,Checkbox:b,CheckboxGroup:b.Group,DragOutlined:D,ScrollContainer:Ie,Divider:A,Icon:Oe},emits:["columns-change"],setup(e,{emit:t,attrs:n}){const{t:l}=ce(),o=J(),a=Je(!0);tt((()=>a.value=!1));const i=k(o.getRowSelection(),"selectedRowKeys");let c=!1;const u=Je([]),d=Je([]),f=Je([]),p=Je(null),g=rt({checkAll:!0,checkedList:[],defaultCheckList:[]}),m=Je(!1),h=Je(!1),{prefixCls:b}=re("basic-column-setting"),v=Ne((()=>Qe(null==o?void 0:o.getBindValues)||{})),C=Ne((()=>{let t={};return e.isMobile&&(t.visible=!1),t}));let y;const S=Je(),{saveSetting:w,resetSetting:x}=Ht({state:g,popoverVisible:a,plainOptions:d,plainSortOptions:f,sortableOrder:S,checkIndex:m},O,I);function R(){const e=[];return o.getColumns({ignoreIndex:!0,ignoreAction:!0}).forEach((t=>{e.push(s({label:t.title||t.customTitle,value:t.dataIndex||t.title},t))})),e}et((()=>{setTimeout((()=>{o.getColumns().length&&!g.isInit&&function(){const e=R(),t=o.getColumns({ignoreAction:!0}).map((e=>e.defaultHidden?"":e.dataIndex||e.title)).filter(Boolean);d.value.length?Qe(d).forEach((t=>{const n=e.find((e=>e.dataIndex===t.dataIndex));n&&(t.fixed=n.fixed)})):(d.value=e,f.value=e,u.value=e,g.defaultCheckList=t);g.isInit=!0,g.checkedList=t}()}),0)})),et((()=>{const e=Qe(v);m.value=!!e.showIndexColumn,h.value=!!e.rowSelection}));const T=Ne((()=>{const e=d.value.length;let t=g.checkedList.length;return Qe(m)&&t--,t>0&&t<e}));function I(e,t){var n;if(!g.checkedList.includes(e.dataIndex))return;const l=R(),a=e.fixed!==t&&t,i=l.findIndex((t=>t.dataIndex===e.dataIndex));-1!==i&&(l[i].fixed=a),e.fixed=a,a&&!e.width&&(e.width=100),null==(n=o.setCacheColumnsByField)||n.call(o,e.dataIndex,{fixed:a}),O(l)}function O(e){o.setColumns(e);const n=Qe(f).map((t=>{const n=-1!==e.findIndex((e=>e===t.value||"string"!=typeof e&&e.dataIndex===t.value));return{dataIndex:t.value,fixed:t.fixed,visible:n}}));t("columns-change",n)}return r(s({getBindProps:C,t:l},dt(g)),{popoverVisible:a,indeterminate:T,onCheckAllChange:function(e){const t=d.value.map((e=>e.value));e.target.checked?(g.checkedList=t,O(t)):(g.checkedList=[],O([]))},onChange:function(e){const t=f.value.length;g.checkAll=e.length===t;const n=Qe(f).map((e=>e.value));e.sort(((e,t)=>n.indexOf(e)-n.indexOf(t))),O(e)},plainOptions:d,reset:function(){g.checkedList=[...g.defaultCheckList],g.checkAll=!0,d.value=Qe(u),f.value=Qe(u),O(o.getCacheColumns()),S.value&&y.sort(S.value),x()},saveSetting:w,prefixCls:b,columnListRef:p,handleVisibleChange:function(){c||tt((()=>{const e=Qe(p);if(!e)return;const t=e.$el;t&&(y=E.create(Qe(t),{animation:500,delay:400,delayOnTouchOnly:!0,handle:".table-column-drag-icon ",onEnd:e=>{const{oldIndex:t,newIndex:n}=e;if(Fe(t)||Fe(n)||t===n)return;const l=P(f.value);t>n?(l.splice(n,0,l[t]),l.splice(t+1,1)):(l.splice(n+1,0,l[t]),l.splice(t,1)),f.value=l,O(l)}}),S.value||(S.value=y.toArray()),c=!0)}))},checkIndex:m,checkSelect:h,handleIndexCheckChange:function(e){o.setProps({showIndexColumn:e.target.checked})},handleSelectCheckChange:function(e){o.setProps({rowSelection:e.target.checked?i:void 0})},defaultRowSelection:i,handleColumnFixed:I,getPopupContainer:function(){return ge(n.getPopupContainer)?n.getPopupContainer():_e()}})}}),[["render",function(e,t,n,l,o,a){const i=$e("Checkbox"),s=$e("DragOutlined"),r=$e("Icon"),c=$e("Tooltip"),u=$e("Divider"),d=$e("CheckboxGroup"),f=$e("ScrollContainer"),p=$e("a-button"),g=$e("SettingOutlined"),m=$e("Popover");return Be(),We(c,st({placement:"top"},e.getBindProps),{title:qe((()=>[it("span",null,ze(e.t("component.table.settingColumn")),1)])),default:qe((()=>[Ve(m,{visible:e.popoverVisible,"onUpdate:visible":t[3]||(t[3]=t=>e.popoverVisible=t),placement:"bottomLeft",trigger:"click",onVisibleChange:e.handleVisibleChange,overlayClassName:`${e.prefixCls}__cloumn-list`,getPopupContainer:e.getPopupContainer},{title:qe((()=>[it("div",{class:Ge(`${e.prefixCls}__popover-title`)},[Ve(i,{indeterminate:e.indeterminate,checked:e.checkAll,"onUpdate:checked":t[0]||(t[0]=t=>e.checkAll=t),onChange:e.onCheckAllChange},{default:qe((()=>[je(ze(e.t("component.table.settingColumnShow")),1)])),_:1},8,["indeterminate","checked","onChange"]),Ve(i,{checked:e.checkIndex,"onUpdate:checked":t[1]||(t[1]=t=>e.checkIndex=t),onChange:e.handleIndexCheckChange},{default:qe((()=>[je(ze(e.t("component.table.settingIndexColumnShow")),1)])),_:1},8,["checked","onChange"])],2)])),content:qe((()=>[Ve(f,null,{default:qe((()=>[Ve(d,{value:e.checkedList,"onUpdate:value":t[2]||(t[2]=t=>e.checkedList=t),onChange:e.onChange,ref:"columnListRef"},{default:qe((()=>[(Be(!0),He(Ze,null,ft(e.plainOptions,(t=>(Be(),He(Ze,{key:t.value},[!("ifShow"in t)||t.ifShow?(Be(),He("div",{key:0,class:Ge(`${e.prefixCls}__check-item`)},[Ve(s,{class:"table-column-drag-icon"}),Ve(i,{value:t.value},{default:qe((()=>[je(ze(t.label),1)])),_:2},1032,["value"]),Ve(c,{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:e.getPopupContainer},{title:qe((()=>[je(ze(e.t("component.table.settingFixedLeft")),1)])),default:qe((()=>[Ve(r,{icon:"line-md:arrow-align-left",class:Ge([`${e.prefixCls}__fixed-left`,{active:"left"===t.fixed,disabled:!e.checkedList.includes(t.value)}]),onClick:n=>e.handleColumnFixed(t,"left")},null,8,["class","onClick"])])),_:2},1032,["getPopupContainer"]),Ve(u,{type:"vertical"}),Ve(c,{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:e.getPopupContainer},{title:qe((()=>[je(ze(e.t("component.table.settingFixedRight")),1)])),default:qe((()=>[Ve(r,{icon:"line-md:arrow-align-left",class:Ge([`${e.prefixCls}__fixed-right`,{active:"right"===t.fixed,disabled:!e.checkedList.includes(t.value)}]),onClick:n=>e.handleColumnFixed(t,"right")},null,8,["class","onClick"])])),_:2},1032,["getPopupContainer"])],2)):Ue("",!0)],64)))),128))])),_:1},8,["value","onChange"])])),_:1}),it("div",{class:Ge(`${e.prefixCls}__popover-footer`)},[Ve(p,{size:"small",onClick:e.reset},{default:qe((()=>[je(ze(e.t("common.resetText")),1)])),_:1},8,["onClick"]),Ve(p,{size:"small",type:"primary",onClick:e.saveSetting},{default:qe((()=>[je(" 保存 ")])),_:1},8,["onClick"])],2)])),default:qe((()=>[Ve(g)])),_:1},8,["visible","onVisibleChange","overlayClassName","getPopupContainer"])])),_:1},16)}]]);const jt=ie(Me({name:"SizeSetting",props:{isMobile:Boolean},components:{ColumnHeightOutlined:M,Tooltip:K,Dropdown:$,Menu:B,MenuItem:B.Item},setup(e){const t=J(),{t:n}=ce(),l=Je([t.getSize()]);return{getBindProps:Ne((()=>{let t={};return e.isMobile&&(t.visible=!1),t})),handleTitleClick:function({key:e}){l.value=[e],t.setProps({size:e})},selectedKeysRef:l,getPopupContainer:_e,t:n}}}),[["render",function(e,t,n,l,o,a){const i=$e("ColumnHeightOutlined"),s=$e("MenuItem"),r=$e("Menu"),c=$e("Dropdown"),u=$e("Tooltip");return Be(),We(u,st({placement:"top"},e.getBindProps),{title:qe((()=>[it("span",null,ze(e.t("component.table.settingDens")),1)])),default:qe((()=>[Ve(c,{placement:"bottom",trigger:["click"],getPopupContainer:e.getPopupContainer},{overlay:qe((()=>[Ve(r,{onClick:e.handleTitleClick,selectable:"",selectedKeys:e.selectedKeysRef,"onUpdate:selectedKeys":t[0]||(t[0]=t=>e.selectedKeysRef=t)},{default:qe((()=>[Ve(s,{key:"default"},{default:qe((()=>[it("span",null,ze(e.t("component.table.settingDensDefault")),1)])),_:1}),Ve(s,{key:"middle"},{default:qe((()=>[it("span",null,ze(e.t("component.table.settingDensMiddle")),1)])),_:1}),Ve(s,{key:"small"},{default:qe((()=>[it("span",null,ze(e.t("component.table.settingDensSmall")),1)])),_:1})])),_:1},8,["onClick","selectedKeys"])])),default:qe((()=>[Ve(i)])),_:1},8,["getPopupContainer"])])),_:1},16)}]]);const zt=ie(Me({name:"RedoSetting",props:{isMobile:Boolean},components:{RedoOutlined:H,Tooltip:K},setup(e){const t=J(),{t:n}=ce();return{getBindProps:Ne((()=>{let t={};return e.isMobile&&(t.visible=!1),t})),redo:function(){t.reload(),t.emit("table-redo")},t:n}}}),[["render",function(e,t,n,l,o,a){const i=$e("RedoOutlined"),s=$e("Tooltip");return Be(),We(s,st({placement:"top"},e.getBindProps),{title:qe((()=>[it("span",null,ze(e.t("common.redo")),1)])),default:qe((()=>[Ve(i,{onClick:e.redo},null,8,["onClick"])])),_:1},16)}]]),Vt=Me({name:"FullScreenSetting",props:{isMobile:Boolean},components:{FullscreenExitOutlined:L,FullscreenOutlined:j,Tooltip:K},setup(e){const t=J(),{t:n}=ce(),{toggle:l,isFullscreen:o}=z(t.wrapRef);return{getBindProps:Ne((()=>{let t={};return e.isMobile&&(t.visible=!1),t})),toggle:l,isFullscreen:o,t:n}}});const Nt=Me({name:"TableSetting",components:{ColumnSetting:Lt,SizeSetting:jt,RedoSetting:zt,FullScreenSetting:ie(Vt,[["render",function(e,t,n,l,o,a){const i=$e("FullscreenOutlined"),s=$e("FullscreenExitOutlined"),r=$e("Tooltip");return Be(),We(r,st({placement:"top"},e.getBindProps),{title:qe((()=>[it("span",null,ze(e.t("component.table.settingFullScreen")),1)])),default:qe((()=>[e.isFullscreen?(Be(),We(s,{key:1,onClick:e.toggle},null,8,["onClick"])):(Be(),We(i,{key:0,onClick:e.toggle},null,8,["onClick"]))])),_:1},16)}]])},props:{setting:{type:Object,default:()=>({})},mode:String},emits:["columns-change"],setup(e,{emit:t}){const{t:n}=ce(),l=J();return{getSetting:Ne((()=>s({redo:!0,size:!0,setting:!0,fullScreen:!1},e.setting))),t:n,handleColumnChange:function(e){t("columns-change",e)},getTableContainer:function(){return l?Qe(l.wrapRef):document.body},isMobile:Ne((()=>"mobile"===e.mode))}}}),Wt={class:"table-settings"};const qt=ie(Nt,[["render",function(e,t,n,l,o,a){const i=$e("RedoSetting"),s=$e("SizeSetting"),r=$e("ColumnSetting"),c=$e("FullScreenSetting");return Be(),He("div",Wt,[e.getSetting.redo?(Be(),We(i,{key:0,isMobile:e.isMobile,getPopupContainer:e.getTableContainer},null,8,["isMobile","getPopupContainer"])):Ue("",!0),e.getSetting.size?(Be(),We(s,{key:1,isMobile:e.isMobile,getPopupContainer:e.getTableContainer},null,8,["isMobile","getPopupContainer"])):Ue("",!0),e.getSetting.setting?(Be(),We(r,{key:2,isMobile:e.isMobile,onColumnsChange:e.handleColumnChange,getPopupContainer:e.getTableContainer},null,8,["isMobile","onColumnsChange","getPopupContainer"])):Ue("",!0),e.getSetting.fullScreen?(Be(),We(c,{key:3,isMobile:e.isMobile,getPopupContainer:e.getTableContainer},null,8,["isMobile","getPopupContainer"])):Ue("",!0)])}]]),Gt=Me({name:"BasicTableTitle",components:{BasicTitle:Ke},props:{title:{type:[Function,String]},getSelectRows:{type:Function},helpMessage:{type:[String,Array]}},setup(e){const{prefixCls:t}=re("basic-table-title");return{getTitle:Ne((()=>{const{title:t,getSelectRows:n=(()=>{})}=e;let l=t;return ge(t)&&(l=t({selectRows:n()})),l})),prefixCls:t}}});const Ut=Me({name:"BasicTableHeader",components:{Divider:A,TableTitle:ie(Gt,[["render",function(e,t,n,l,o,a){const i=$e("BasicTitle");return e.getTitle?(Be(),We(i,{key:0,class:Ge(e.prefixCls),helpMessage:e.helpMessage},{default:qe((()=>[je(ze(e.getTitle),1)])),_:1},8,["class","helpMessage"])):Ue("",!0)}]]),TableSetting:qt},props:{title:{type:[Function,String]},tableSetting:{type:Object},showTableSetting:{type:Boolean},titleHelpMessage:{type:[String,Array],default:""}},emits:["columns-change"],setup(e,{emit:t}){const{prefixCls:n}=re("basic-table-header");const{getSelectRowKeys:l,setSelectedRowKeys:o,getRowSelection:a}=J(),i=Ne((()=>l())),s=Ne((()=>a())),r=Ne((()=>{var e;return!0===(null==(e=s.value)?void 0:e.preserveSelectedRowKeys)}));return{prefixCls:n,handleColumnChange:function(e){t("columns-change",e)},selectRowKeys:i,setSelectedRowKeys:o,openRowSelection:s,isAcrossPage:r}}}),Zt={style:{width:"100%"}},Jt={key:0,style:{margin:"5px"}},Yt={style:{margin:"-4px 0 -2px","padding-top":"5px"}},Qt={key:0},Xt={key:1};const en=ie(Ut,[["render",function(e,t,n,l,o,a){const i=$e("TableTitle"),s=$e("Divider"),r=$e("TableSetting"),c=$e("a-button"),u=$e("a-popover"),d=$e("a-divider"),f=$e("a-alert");return Be(),He("div",Zt,[e.$slots.headerTop?(Be(),He("div",Jt,[Le(e.$slots,"headerTop")])):Ue("",!0),it("div",{class:Ge(`flex items-center ${e.prefixCls}__table-title-box`)},[it("div",{class:Ge(`${e.prefixCls}__tableTitle`)},[e.$slots.tableTitle?Le(e.$slots,"tableTitle",{key:0}):Ue("",!0),!e.$slots.tableTitle&&e.title?(Be(),We(i,{key:1,helpMessage:e.titleHelpMessage,title:e.title},null,8,["helpMessage","title"])):Ue("",!0)],2),it("div",{class:Ge(`${e.prefixCls}__toolbar`)},[Le(e.$slots,"toolbar"),e.$slots.toolbar&&e.showTableSetting?(Be(),We(s,{key:0,type:"vertical"})):Ue("",!0),e.showTableSetting?(Be(),We(r,{key:1,class:Ge(`${e.prefixCls}__toolbar-desktop`),style:{"white-space":"nowrap"},setting:e.tableSetting,onColumnsChange:e.handleColumnChange},null,8,["class","setting","onColumnsChange"])):Ue("",!0),Ve(u,{overlayClassName:`${e.prefixCls}__toolbar-mobile`,trigger:"click",placement:"left",getPopupContainer:e=>e.parentElement},{content:qe((()=>[e.showTableSetting?(Be(),We(r,{key:0,mode:"mobile",setting:e.tableSetting,onColumnsChange:e.handleColumnChange},null,8,["setting","onColumnsChange"])):Ue("",!0)])),default:qe((()=>[e.showTableSetting?(Be(),We(c,{key:0,class:Ge(`${e.prefixCls}__toolbar-mobile`),type:"text",preIcon:"ant-design:menu",shape:"circle"},null,8,["class"])):Ue("",!0)])),_:1},8,["overlayClassName","getPopupContainer"])],2)],2),it("div",Yt,[Le(e.$slots,"tableTop",{},(()=>[null!=e.openRowSelection?(Be(),We(f,{key:0,type:"info","show-icon":"",class:"alert"},{message:qe((()=>[e.selectRowKeys.length>0?(Be(),He(Ze,{key:0},[it("span",null,[it("span",null,"已选中 "+ze(e.selectRowKeys.length)+" 条记录",1),e.isAcrossPage?(Be(),He("span",Qt,"(可跨页)")):Ue("",!0)]),Ve(d,{type:"vertical"}),it("a",{onClick:t[0]||(t[0]=t=>e.setSelectedRowKeys([]))},"清空"),Le(e.$slots,"alertAfter")],64)):(Be(),He("span",Xt,"未选中任何数据"))])),_:3})):Ue("",!0)]))])])}]]);function tn(e,t,n){const l=Je([]),o=Ne((()=>Qe(e).autoCreateKey&&!Qe(e).rowKey)),a=Ne((()=>{const{rowKey:t}=Qe(e);return Qe(o)?ee:t}));function i(n){const l=[],{childrenColumnName:o}=Qe(e);return nt(n||Qe(t)).forEach((e=>{l.push(e[Qe(a)]);const t=e[o||"children"];(null==t?void 0:t.length)&&l.push(...i(t))})),l}return{getExpandOption:Ne((()=>{const{isTreeTable:t}=Qe(e);return t?{expandedRowKeys:Qe(l),onExpandedRowsChange:e=>{l.value=e,n("expanded-rows-change",e)}}:{}})),expandAll:function(){const e=i();l.value=e},collapseAll:function(){l.value=[]}}}const nn="_row",ln="_index";const on=ie(Me({name:"BasicTableFooter",components:{Table:V},props:{summaryFunc:{type:Function},summaryData:{type:Array},scroll:{type:Object},rowKey:fe.string.def("key")},setup(e){const t=J(),n=Ne((()=>{const{summaryFunc:n,summaryData:l}=e;if(null==l?void 0:l.length)return l.forEach(((t,n)=>t[e.rowKey]=`${n}`)),l;if(!ge(n))return[];let o=nt(Qe(t.getDataSource()));return o=n(o),o.forEach(((t,n)=>{t[e.rowKey]=`${n}`})),o}));return{getColumns:Ne((()=>{const e=Qe(n),l=P(t.getColumns()),o=l.findIndex((e=>e.flag===Q)),a=e.some((e=>Reflect.has(e,nn))),i=e.some((e=>Reflect.has(e,ln)));if(-1!==o&&(i?(l[o].customRender=({record:e})=>e[ln],l[o].ellipsis=!1):Reflect.deleteProperty(l[o],"customRender")),t.getRowSelection()&&a){const e=l.some((e=>"left"===e.fixed));l.unshift(r(s({width:60,title:"selection",key:"selectionKey",align:"center"},e?{fixed:"left"}:{}),{customRender:({record:e})=>e[nn]}))}return l})),getDataSource:n}}}),[["render",function(e,t,n,l,o,a){const i=$e("Table");return e.summaryFunc||e.summaryData?(Be(),We(i,{key:0,showHeader:!1,bordered:!1,pagination:!1,dataSource:e.getDataSource,rowKey:t=>t[e.rowKey],columns:e.getColumns,tableLayout:"fixed",scroll:e.scroll},null,8,["dataSource","rowKey","columns","scroll"])):Ue("",!0)}]]);function an(e,t,n,l){const o=Ne((()=>0===(Qe(l)||[]).length)),a=Ne((()=>{const{summaryFunc:n,showSummary:l,summaryData:a}=Qe(e);return l&&!Qe(o)?()=>Xe(on,{summaryFunc:n,summaryData:a,scroll:Qe(t)}):void 0}));return et((()=>{!function(){const{showSummary:t}=Qe(e);if(!t||Qe(o))return;tt((()=>{const e=Qe(n);if(!e)return;const t=e.$el.querySelector(".ant-table-content");Ae({el:t,name:"scroll",listener:()=>{const n=e.$el.querySelector(".ant-table-footer .ant-table-content");n&&t&&(n.scrollLeft=t.scrollLeft)},wait:0,options:!0})}))}()})),{getFooterProps:a}}const sn=ie(Me({components:{Table:V,BasicForm:N,HeaderCell:xt},props:{clickToRowSelect:fe.bool.def(!0),isTreeTable:fe.bool.def(!1),tableSetting:fe.shape({}),inset:fe.bool,sortFn:{type:Function,default:ne},filterFn:{type:Function,default:le},showTableSetting:fe.bool,autoCreateKey:fe.bool.def(!0),striped:fe.bool.def(!1),showSummary:fe.bool,summaryFunc:{type:[Function,Array],default:null},summaryData:{type:Array,default:null},indentSize:fe.number.def(24),canColDrag:fe.bool.def(!0),api:{type:Function,default:null},beforeFetch:{type:Function,default:null},afterFetch:{type:Function,default:null},handleSearchInfoFn:{type:Function,default:null},fetchSetting:{type:Object,default:()=>te},immediate:fe.bool.def(!0),emptyDataIsShowTable:fe.bool.def(!0),searchInfo:{type:Object,default:null},defSort:{type:Object,default:null},useSearchForm:fe.bool,formConfig:{type:Object,default:null},columns:{type:[Array],default:()=>[]},showIndexColumn:fe.bool.def(!0),indexColumnProps:{type:Object,default:null},showActionColumn:{type:Boolean,default:!0},actionColumn:{type:Object,default:null},ellipsis:fe.bool.def(!0),canResize:fe.bool.def(!0),clearSelectOnPageChange:fe.bool,resizeHeightOffset:fe.number.def(0),rowSelection:{type:Object,default:null},title:{type:[String,Function],default:null},titleHelpMessage:{type:[String,Array]},minHeight:fe.number,maxHeight:fe.number,dataSource:{type:Array,default:null},rowKey:{type:[String,Function],default:""},bordered:fe.bool,pagination:{type:[Object,Boolean],default:null},loading:fe.bool,rowClassName:{type:Function},scroll:{type:Object,default:null},beforeEditSubmit:{type:Function},size:{type:String,default:oe}},emits:["fetch-success","fetch-error","selection-change","register","row-click","row-dbClick","row-contextmenu","row-mouseenter","row-mouseleave","edit-end","edit-cancel","edit-row-end","edit-change","expanded-rows-change","change","columns-change","table-redo"],setup(e,{attrs:t,emit:n,slots:l,expose:o}){const a=Je(null),i=Je([]),u=Je(null),d=Je(),{prefixCls:f}=re("basic-table"),[p,g]=W(),m=Ne((()=>s(s({},e),Qe(d)))),h=pt(Ct,!1);et((()=>{Qe(h)&&e.canResize&&Ee("'canResize' of BasicTable may not work in PageWrapper with 'fixedHeight' (especially in hot updates)")}));const{getLoading:b,setLoading:v}=function(e){const t=Je(Qe(e).loading);return Ye((()=>Qe(e).loading),(e=>{t.value=e})),{getLoading:Ne((()=>Qe(t))),setLoading:function(e){t.value=e}}}(m),{getPaginationInfo:C,getPagination:y,setPagination:S,setShowPagination:w,getShowPagination:x}=function(e){const{t:t}=ce(),n=Je({}),l=Je(!0);Ye((()=>Qe(e).pagination),(e=>{!ue(e)&&e&&(n.value=s(s({},Qe(n)),null!=e?e:{}))}));const o=Ne((()=>{const{pagination:o}=Qe(e);return!(!Qe(l)||ue(o)&&!o)&&s(s({current:1,pageSize:q,size:"small",defaultPageSize:q,showTotal:e=>t("component.table.total",{total:e}),showSizeChanger:!0,pageSizeOptions:G,itemRender:kt,showQuickJumper:!0},ue(o)?{}:o),Qe(n))}));return{getPagination:function(){return Qe(o)},getPaginationInfo:o,setShowPagination:function(e){return c(this,null,(function*(){l.value=e}))},getShowPagination:function(){return Qe(l)},setPagination:function(e){const t=Qe(o);n.value=s(s({},ue(t)?{}:t),e)}}}(m),{getRowSelection:R,getRowSelectionRef:T,getSelectRows:P,clearSelectedRowKeys:I,getSelectRowKeys:O,deleteSelectRowByKey:F,setSelectedRowKeys:_}=function(e,t,n){const l=Je([]),o=Je([]),a=Ne((()=>{const{rowSelection:t}=Qe(e);return t?s({preserveSelectedRowKeys:!0,selectedRowKeys:Qe(l),onChange:e=>{c(e)}},k(t,["onChange"])):null}));Ye((()=>{var t;return null==(t=Qe(e).rowSelection)?void 0:t.selectedRowKeys}),(e=>{c(e)})),Ye((()=>Qe(l)),(()=>{tt((()=>{const{rowSelection:l}=Qe(e);if(l){const{onChange:e}=l;e&&ge(e)&&e(u(),d())}Qe(t).length>0&&n("selection-change",{keys:u(),rows:d()})}))}),{deep:!0});const i=Ne((()=>Qe(e).autoCreateKey&&!Qe(e).rowKey)),r=Ne((()=>{const{rowKey:t}=Qe(e);return Qe(i)?ee:t}));function c(n){var a;l.value=n;const i=xe(nt(Qe(t)).concat(nt(Qe(o))),(e=>n.includes(e[Qe(r)])),{children:null!=(a=e.value.childrenColumnName)?a:"children"}),s=[];n.forEach((e=>{const t=i.find((t=>t[Qe(r)]===e));t&&s.push(t)})),o.value=s}function u(){return Qe(l)}function d(){return Qe(o)}return{getRowSelection:function(){return Qe(a)},getRowSelectionRef:a,getSelectRows:d,getSelectRowKeys:u,setSelectedRowKeys:c,clearSelectedRowKeys:function(){o.value=[],l.value=[]},deleteSelectRowByKey:function(e){const t=Qe(l).findIndex((t=>t===e));-1!==t&&Qe(l).splice(t,1)},setSelectedRows:function(e){o.value=e}}}(m,i,n),{handleTableChange:K,getDataSourceRef:D,getDataSource:A,getRawDataSource:E,setTableData:M,updateTableDataRecord:$,deleteTableDataRecord:B,insertTableDataRecord:H,findTableDataRecord:L,fetch:j,getRowKey:z,reload:V,getAutoCreateKey:N,updateTableData:U}=Et(m,{tableData:i,getPaginationInfo:C,setLoading:v,setPagination:S,validate:g.validate,clearSelectedRowKeys:I},n);const{getViewColumns:Z,getColumns:J,setCacheColumnsByField:Y,setColumns:Q,getColumnsRef:X,getCacheColumns:te}=Dt(m,C),{getScrollRef:ne,redoHeight:le}=$t(m,a,X,T,D),{customRow:oe}=Bt(m,{setSelectedRowKeys:_,getSelectRowKeys:O,clearSelectedRowKeys:I,getAutoCreateKey:N,emit:n}),{getRowClassName:ie}=function(e,t){return{getRowClassName:function(n,l){const{striped:o,rowClassName:a}=Qe(e),i=[];return o&&i.push((l||0)%2==1?`${t}-row__striped`:""),a&&ge(a)&&i.push(a(n,l)),i.filter((e=>!!e)).join(" ")}}}(m,f),{getExpandOption:se,expandAll:de,collapseAll:fe}=tn(m,i,n),pe={onColumnsChange:e=>{var t,l;n("columns-change",e),null==(l=(t=Qe(m)).onColumnsChange)||l.call(t,e)}},{getHeaderProps:me}=function(e,t,n){return{getHeaderProps:Ne((()=>{const{title:l,showTableSetting:o,titleHelpMessage:a,tableSetting:i}=Qe(e),r=!(t.tableTitle||l||t.toolbar||o);return r&&!he(l)?{}:{title:r?null:()=>Xe(en,{title:l,titleHelpMessage:a,showTableSetting:o,tableSetting:i,onColumnsChange:n.onColumnsChange},s(s(s(s(s({},t.toolbar?{toolbar:()=>De(t,"toolbar")}:{}),t.tableTitle?{tableTitle:()=>De(t,"tableTitle")}:{}),t.headerTop?{headerTop:()=>De(t,"headerTop")}:{}),t.tableTop?{tableTop:()=>De(t,"tableTop")}:{}),t.alertAfter?{alertAfter:()=>De(t,"alertAfter")}:{}))}}))}}(m,l,pe),{getFooterProps:be}=an(m,ne,a,D),{getFormProps:ve,replaceFormSlotKey:Ce,getFormSlotKeys:ye,handleSearchInfoChange:Se}=function(e,t,n,l){return{getFormProps:Ne((()=>{const{formConfig:t}=Qe(e),{submitButtonOptions:n,autoSubmitOnEnter:o}=t||{};return r(s({showAdvancedButton:!0},t),{submitButtonOptions:s({loading:Qe(l)},n),compact:!0,autoSubmitOnEnter:o})})),replaceFormSlotKey:function(e){var t,n;return e&&null!=(n=null==(t=null==e?void 0:e.replace)?void 0:t.call(e,/form\-/,""))?n:""},getFormSlotKeys:Ne((()=>Object.keys(t).map((e=>e.startsWith("form-")?e:null)).filter((e=>!!e)))),handleSearchInfoChange:function(t){const{handleSearchInfoFn:l}=Qe(e);l&&ge(l)&&(t=l(t)||t),n({searchInfo:t,page:1})}}}(m,l,j,b),we=Ne((()=>{const e=Qe(D);let n=s(r(s(s(r(s({},t),{customRow:oe}),Qe(m)),Qe(me)),{scroll:Qe(ne),loading:Qe(b),tableLayout:"fixed",rowSelection:Qe(T),rowKey:Qe(z),columns:nt(Qe(Z)),pagination:nt(Qe(C)),dataSource:e,footer:Qe(be)}),Qe(se));return n=k(n,["class","onChange"]),n})),ke=Ne((()=>{const e=Qe(we);return[f,t.class,{[`${f}-form-container`]:e.useSearchForm,[`${f}--inset`]:e.inset}]})),Re=Ne((()=>{const{emptyDataIsShowTable:e,useSearchForm:t}=Qe(m);return!(!e&&t)||!!Qe(D).length})),Te=Je(!0);Ye((()=>we.value.dataSource),(()=>{Te.value=!1,setTimeout((()=>{tt((()=>{Te.value=!0}))}),200)}));const Pe={reload:V,getSelectRows:P,clearSelectedRowKeys:I,getSelectRowKeys:O,deleteSelectRowByKey:F,setPagination:S,setTableData:M,updateTableDataRecord:$,deleteTableDataRecord:B,insertTableDataRecord:H,findTableDataRecord:L,redoHeight:le,setSelectedRowKeys:_,setColumns:Q,setLoading:v,getDataSource:A,getRawDataSource:E,setProps:function(e){d.value=s(s({},Qe(d)),e)},getRowSelection:R,getPaginationRef:y,getColumns:J,getCacheColumns:te,emit:n,updateTableData:U,setShowPagination:w,getShowPagination:x,setCacheColumnsByField:Y,expandAll:de,collapseAll:fe,getSize:()=>Qe(we).size};return ae(r(s({},Pe),{wrapRef:u,getBindValues:we})),o(Pe),n("register",Pe,g),{tableElRef:a,getBindValues:we,getLoading:b,registerForm:p,handleSearchInfoChange:Se,getEmptyDataIsShowTable:Re,handleTableChange:function(...e){K.call(void 0,...e),n("change",...e);const{onChange:t}=Qe(m);t&&ge(t)&&t.call(void 0,...e)},getRowClassName:ie,wrapRef:u,tableAction:Pe,redoHeight:le,handleResizeColumn:(e,t)=>{t.width=e},getFormProps:ve,replaceFormSlotKey:Ce,getFormSlotKeys:ye,getWrapperClass:ke,columns:Z,isVisitableTable:Te}}}),[["render",function(e,t,n,l,o,a){const i=$e("BasicForm"),s=$e("HeaderCell"),r=$e("Table"),c=$e("a-form-item-rest");return Be(),He("div",{ref:"wrapRef",class:Ge(e.getWrapperClass)},[e.getBindValues.useSearchForm?(Be(),We(i,st({key:0,submitOnReset:""},e.getFormProps,{tableAction:e.tableAction,onRegister:e.registerForm,onSubmit:e.handleSearchInfoChange,onAdvancedChange:e.redoHeight}),gt({_:2},[ft(e.getFormSlotKeys,(t=>({name:e.replaceFormSlotKey(t),fn:qe((n=>[Le(e.$slots,t,mt(ht(n||{})))]))})))]),1040,["tableAction","onRegister","onSubmit","onAdvancedChange"])):Ue("",!0),e.isVisitableTable?(Be(),We(c,{key:1},{default:qe((()=>[ot(Ve(r,st({ref:"tableElRef"},e.getBindValues,{rowClassName:e.getRowClassName,onResizeColumn:e.handleResizeColumn,onChange:e.handleTableChange}),gt({headerCell:qe((({column:e})=>[Ve(s,{column:e},null,8,["column"])])),bodyCell:qe((t=>[Le(e.$slots,"bodyCell",mt(ht(t||{})))])),_:2},[ft(Object.keys(e.$slots),(t=>({name:t,fn:qe((n=>[Le(e.$slots,t,mt(ht(n||{})))]))})))]),1040,["rowClassName","onResizeColumn","onChange"]),[[at,e.getEmptyDataIsShowTable]])])),_:3})):Ue("",!0)],2)}]]),rn=Object.freeze(Object.defineProperty({__proto__:null,default:sn},Symbol.toStringTag,{value:"Module"}));export{sn as B,Ct as P,rn as a,Mt as o};
