import{an as e}from"./vendor.ece5be17.js";import{B as a}from"./index.a6220f15.js";import{aa as t,L as s,d as l,A as o,_ as r}from"./index.8e60a3c0.js";import{d as n,k as i,r as u,e as d,u as c,Y as v,a2 as f,ab as m,ad as p,f as g,E as h,ak as _,a4 as C,a3 as y,ai as b,F as I,Z as k,ac as S,ag as M,a5 as w,a6 as x,a7 as L}from"./vue-vendor.1938e417.js";import"./__commonjsHelpers__.488ed5c2.js";import"./BasicModal.cadf9873.js";import"./useWindowSizeFn.6b4ca4c0.js";const j=n({name:"loginSelect",components:{Avatar:e,BasicModal:a},emits:["success","register"],setup(e,{emit:a}){const r=t(),{notification:n}=o(),v=i(!1),f=i([]),m=i(""),p=i(!1),g=i([]),h=i(""),_=i(!1),C=i(""),y=i(),b=u({orgCode:void 0,tenantId:null}),[I,{closeModal:k}]=s(),S=d((()=>c(p)&&c(v)?"请选择租户和部门":c(p)&&!c(v)?"请选择部门":!c(p)&&c(v)?"请选择租户":void 0)),M=i({tenantId:[{required:c(v),type:"number",message:"请选择租户",trigger:"change"}],orgCode:[{required:c(p),message:"请选择部门",trigger:"change"}]});function w(){f.value=[],m.value="",g.value=[],h.value=""}return{registerModal:I,visible:_,tenantList:f,isMultiTenant:v,validate_status:m,isMultiDepart:p,departList:g,validate_status1:h,formState:b,rules:M,layout:{labelCol:{span:4},wrapperCol:{span:18}},formRef:y,currTitle:S,config:{maskClosable:!1,closable:!1,canFullscreen:!1,width:"500px",minHeight:20,maxHeight:20},handleTenantChange:function(e){m.value=""},handleDepartChange:function(e){h.value=""},show:function(e){return t=this,s=null,l=function*(){e&&(C.value=r.username,yield w(),yield function(e){var a,t;if((null==(a=e.userInfo)?void 0:a.orgCode)&&""!==(null==(t=e.userInfo)?void 0:t.orgCode))return void(p.value=!1);let s=e.multi_depart;0==s?(n.warn({message:"提示",description:"您尚未归属部门,请确认账号信息",duration:3}),p.value=!1):2==s?(p.value=!0,g.value=e.departs):p.value=!1}(e),c(p)||c(v)?_.value=!0:a("success",r.getUserInfo)),e.isLogin=!1,r.setLoginInfo(e)},new Promise(((e,a)=>{var o=e=>{try{n(l.next(e))}catch(t){a(t)}},r=e=>{try{n(l.throw(e))}catch(t){a(t)}},n=a=>a.done?e(a.value):Promise.resolve(a.value).then(o,r);n((l=l.apply(t,s)).next())}));var t,s,l},handleSubmit:function(){return c(v)&&!b.tenantId?(m.value="error",!1):c(p)&&!b.orgCode?(h.value="error",!1):void y.value.validate().then((()=>{new Promise(((e,a)=>{if(c(p)||c(v)){let t={orgCode:b.orgCode,username:c(C)};l.put({url:"/sys/selectDepart",params:t}).then((t=>{var s;t.userInfo?(r.setUserInfo(t.userInfo),e()):(s=t,n.error({message:"登录失败",description:((s.response||{}).data||{}).message||s.message||"请求出现错误，请稍后再试",duration:4}),r.logout(),a())}))}else e()})).then((()=>{a("success")})).catch((e=>{})).finally((()=>{k(),w()}))})).catch((e=>{}))}}}}),T=e=>(w("data-v-a48cf5d4"),e=e(),x(),e),D=T((()=>L("span",null,"您隶属于多租户，请选择登录租户",-1))),U=T((()=>L("span",{style:{color:"#ed6f6f"}},"请选择登录租户",-1))),B=T((()=>L("span",null,"您隶属于多部门，请选择登录部门",-1))),F=T((()=>L("span",{style:{color:"#ed6f6f"}},"请选择登录部门",-1)));const R=r(j,[["render",function(e,a,t,s,l,o){const r=v("a-avatar"),n=v("a-tooltip"),i=v("a-select-option"),u=v("a-select"),d=v("a-form-item"),c=v("a-form"),w=v("a-button"),x=v("BasicModal");return f(),m(x,S(e.config,{onRegister:e.registerModal,title:e.currTitle,wrapClassName:"loginSelectModal",visible:e.visible,"onUpdate:visible":a[2]||(a[2]=a=>e.visible=a)}),{footer:p((()=>[g(w,{onClick:e.handleSubmit,type:"primary"},{default:p((()=>[h("确认")])),_:1},8,["onClick"])])),default:p((()=>[g(c,S({ref:"formRef",model:e.formState,rules:e.rules},e.layout,{colon:!1,class:"loginSelectForm"}),{default:p((()=>[e.isMultiTenant?(f(),m(d,{key:0,name:"tenantId","validate-status":e.validate_status},_({label:p((()=>[g(n,{placement:"topLeft"},{title:p((()=>[D])),default:p((()=>[g(r,{style:{"background-color":"#87d068"},size:30},{default:p((()=>[h(" 租户 ")])),_:1})])),_:1})])),default:p((()=>[g(u,{value:e.formState.tenantId,"onUpdate:value":a[0]||(a[0]=a=>e.formState.tenantId=a),onChange:e.handleTenantChange,placeholder:"请选择登录租户",class:C({"valid-error":"error"==e.validate_status})},{default:p((()=>[(f(!0),y(I,null,b(e.tenantList,(e=>(f(),m(i,{key:e.id,value:e.id},{default:p((()=>[h(M(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","onChange","class"])])),_:2},["error"==e.validate_status?{name:"extra",fn:p((()=>[U])),key:"0"}:void 0]),1032,["validate-status"])):k("",!0),e.isMultiDepart?(f(),m(d,{key:1,"validate-status":e.validate_status1,colon:!1},_({label:p((()=>[g(n,{placement:"topLeft"},{title:p((()=>[B])),default:p((()=>[g(r,{style:{"background-color":"rgb(104, 208, 203)"},size:30},{default:p((()=>[h(" 部门 ")])),_:1})])),_:1})])),default:p((()=>[g(u,{value:e.formState.orgCode,"onUpdate:value":a[1]||(a[1]=a=>e.formState.orgCode=a),onChange:e.handleDepartChange,placeholder:"请选择登录部门",class:C({"valid-error":"error"==e.validate_status1})},{default:p((()=>[(f(!0),y(I,null,b(e.departList,(e=>(f(),m(i,{key:e.orgCode,value:e.orgCode},{default:p((()=>[h(M(e.departName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","onChange","class"])])),_:2},["error"==e.validate_status1?{name:"extra",fn:p((()=>[F])),key:"0"}:void 0]),1032,["validate-status"])):k("",!0)])),_:1},16,["model","rules"])])),_:1},16,["onRegister","title","visible"])}],["__scopeId","data-v-a48cf5d4"]]);export{R as default};
